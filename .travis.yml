language: minimal

sudo: true

env:
  global:
    - HUGO_VERSION=0.58.3
    - LOGGER_ENDPOINT=https://mooc-accessibility.inria.fr/api/log
    - PLAYER_VERSION=v2.1.3
    - MATOMO_SITE_ID=100
    - HUGO_BASE_URL=https://mooc-accessibility.inria.fr/

git:
  quiet: true

notifications:
  email: false

before_install:
  - sudo apt-get update
  - sudo apt-get install -y unzip

install:
  - curl -LO https://github.com/gohugoio/hugo/releases/download/v${HUGO_VERSION}/hugo_${HUGO_VERSION}_Linux-64bit.deb
  - sudo dpkg -i hugo_${HUGO_VERSION}_Linux-64bit.deb

before_script:
  - curl -LO https://github.com/dashdashzako/aiana-player/releases/download/${PLAYER_VERSION}/release.zip
  - unzip release.zip
  - mv release/manifest.yml data/manifest.yml
  - mv release/*.js static/js/
  - 'echo "url: ${LOGGER_ENDPOINT}" > data/logger.yml'
  - 'echo "site_id: ${MATOMO_SITE_ID}" > data/matomo.yml'

script:
  - rm -rf public
  - rm release.zip
  - hugo --baseUrl ${HUGO_BASE_URL}
  - zip -r release.zip public

deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: XB6K36oKwft4KQd6wvQ+f/ScDtsFOAOez47RrHvdApOZtY7NpIkYylu2MvY9WlOorEt/Woui46Q6K7vxMUt6e61UZ/Q8kMm5DLwzQRZ6G+Y6Gi8Hxqb7wJfK+mcwNsZvvjXHIKkLS4er6GeEReeepLLgSjwuuPKo0y5vPfly8S9R0f++xIWnCNptLi6zoz5c9jXMZXJX3eYrfNDEhYFWnNFulHPGuapfv6OmY4UKGsxw8+LQG6kkYNmwDXmJkhVurTCZY9F254bjfWUNpN6+ZBxO75t8SPoPERzQ6sdV6+kDT8ZQhp9KI3AfIpKwwh/46RvP9LUglD0/Woalbo/HZIXVMhCpNSDH3YcBeEGLd56ByVK6LSpCCv44LlEsyd4r/jhzPRt+gD/umz6ljULvN9itumGxzn/6TqM/jJfTSTalxOX2jmmAbsN2QFZdltQIjNdO9hAMRCFGrzcGB7cUPsVgjL2f1RBkrCWEFn7KbPNC00w7KtNZywzbJBctaVsAm43pKqfSO+DAKJ3DGx4GqYKThrkgiHG0pBPWfn61W2Zp2IHnSyI7Y1uxWnHqsH7diyhw/sqPDAdxW3bBtAKzmt95UVPs3y+CxxGa+T13rWYWzWknSS8NBiHg0ssTfQibo0BU9zVV/3ZwkYvkyRAKw6esBSPqur5fTTWFoLSjkyI=
  file: release.zip
  on:
    repo: dashdashzako/mooc-accessibility-static
    tags: true
